Мое решение и эталонное используют CTE для структурирования запроса, но значительно различаются по глубине анализа и набору вычисляемых метрик.

Боевая статистика.
Я ограничился подсчетом побед и общего числа боев. Эталонный запрос дополнительно разделяет исходы на поражения и отступления,
что дает более гранулярную картину боевой истории.
Также он вычисляет years_active, используя MIN и MAX по датам боев — полезный контекстуальный показатель, которого в моем решении нет.

Статистика состава.
Эталон расширяет мои данные (current_members, total_members_ever) за счет подсчета смертей (deaths) и средней продолжительности службы (avg_service_days),
что позволяет глубже оценить выживаемость и стабильность состава.

Прогресс навыков.
Здесь подходы принципиально разные. Мой метод с LAG измеряет прирост между последовательными записями о навыках, показывая динамику прокачки.
Эталонный сравнивает уровень навыка на момент вступления в отряд с его последним известным значением, оценивая совокупный результат за все время службы.

Оценка влияния тренировок.
Это ключевое различие. Я просто посчитал avg_training_effectiveness.
Эталонный запрос пытается вычислить прямую статистическую корреляцию (training_battle_correlation) между эффективностью тренировки и исходом последующих боев с помощью CORR.
Концептуально это значительно более сложный подход.

В CTE squad_training_effectiveness используется LEFT JOIN ... ON sb.date > st.date.
Это соединение приводит к тому, что каждая тренировка сопоставляется со всеми последующими битвами.
В результате строки многократно дублируются, что полностью искажает статистическую выборку и делает результат функции CORR некорректным.
Аналогичная проблема с возможным дублированием строк присутствует и в CTE squad_skill_progression из-за условия ds_join.date <= sm.join_date,
если у бойца было несколько записей о навыках до вступления в отряд.

Формула итоговой оценки в эталонном решении также более комплексная. Она включает больше компонентов, чем моя, и использует нормализацию (деление на 5),
чтобы привести показатели с разной шкалой к сопоставимому диапазону, что является лучшей практикой при построении взвешенных оценок.